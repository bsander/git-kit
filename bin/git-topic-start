#!/usr/bin/env bash

# Define command flags
set_flags () {
  cmdarg 't:' 'topic' 'Topic prefix'
  cmdarg 'b?' 'branch' 'Branch to split off from' 'HEAD'
}

# Load shared functions and parse arguments
BASE_DIR=$(d() { (cd -P "$(dirname "$1")" && pwd) }; while [ -h "${S=${BASH_SOURCE[0]}}" ]; do D=$(d "$S"); S=$(readlink "$S"); [[ $S != /* ]] && S="$D/$S"; done; d "$S")
# shellcheck source=functions.sh disable=1091
source "$BASE_DIR/functions.sh"

# shellcheck disable=SC2154
TOPIC=${cmdarg_cfg['topic']:?NEVER HAPPENS - No topic specified}
HEAD=$(git rev-parse --abbrev-ref "${cmdarg_cfg['branch']}")
# shellcheck disable=SC2154
NAME=${cmdarg_argv[0]:?No name specified for topic branch}

git branch "${TOPIC}/${NAME}" "$HEAD"
git checkout -q "${TOPIC}/${NAME}"
